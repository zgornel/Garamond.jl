<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting started ·  </title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../"><img class="logo" src="../assets/logo.png" alt="  logo"/></a><h1> </h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Introduction</a></li><li class="current"><a class="toctext" href>Getting started</a><ul class="internal"><li><a class="toctext" href="#Engine-configuration-1">Engine configuration</a></li><li><a class="toctext" href="#The-search-environment-1">The search environment</a></li><li><a class="toctext" href="#Engine-operations-1">Engine operations</a></li><li><a class="toctext" href="#Results-and-responses-1">Results and responses</a></li></ul></li><li><a class="toctext" href="../configuration/">Configuration</a></li><li><a class="toctext" href="../clientserver/">Client/Server</a></li><li><a class="toctext" href="../build/">Building</a></li><li><a class="toctext" href="../remarks/">Remarks</a></li><li><a class="toctext" href="../api/">API Reference</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Getting started</a></li></ul><a class="edit-page" href="https://github.com/zgornel/Garamond.jl/blob/master/docs/src/getting_started.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Getting started</span><a class="fa fa-bars" href="#"></a></div></header><div class="admonition warning"><div class="admonition-title">Work in progress!</div><div class="admonition-text"><p>This section currently under construction and is incomplete.</p></div></div><h1><a class="nav-anchor" id="Getting-started-1" href="#Getting-started-1">Getting started</a></h1><p>The engine uses a pluggable approach in which data loaders, parsers, recommenders and rankers can be compiled in the engine at runtime. The following usage examples use functionality already provided by the engine. Although by no means exhaustive, it is meant to provide a starting point for exploring the functionality and features of the engine.</p><div class="admonition tip"><div class="admonition-title">Glossary</div><div class="admonition-text"><p>Throughout the documentation, certain terms will appear when refering to the internals of the engine. Some of the most frequent ones are:</p><ul><li><strong>configuration</strong> may refer to:<ul><li>searcher configuration, a <code>SearcherConfig</code> object which holds the configuration options for individual searchers.</li><li>environment configuration, a <code>NamedTuple</code> that contains searcher configurations as well as other parameters.</li><li>data configuration file, a JSON file which is parsed to generate an environment configuration.</li></ul></li><li><strong>search environment</strong> a <code>SearchEnv</code> object that holds the data and searchers among other. It fully describes the state of the engine.</li><li><strong>searcher</strong>, a <code>Searcher</code> object that is used to perform the actual search. It holds the indexed documents in some vectorial representation.</li><li><strong>index</strong> - the data structure holding the vector representation of the documents.</li><li><strong>request</strong> - may refer to:<ul><li>a request form an outside system to the engine i.e. HTTP request.</li><li>the internal representation of a request, of type <code>InternalRequest</code>.</li></ul></li></ul></div></div><h2><a class="nav-anchor" id="Engine-configuration-1" href="#Engine-configuration-1">Engine configuration</a></h2><p>The main configuration of the engine pertains to data loading, parsing and indexing. Its role is to provide all necessary details as well as the internal architecture of the engine. The recommended way for configuring the engine is to create a JSON file with all necessary options. Alternatively, the result of parsing the configuration file i.e. the configuration object can be created explicitly however it is, at least at this point, a cumbersome operation.</p><pre><code class="language-julia-repl">julia&gt; using Logging, JSON, JuliaDB, Garamond

julia&gt; include(joinpath(@__DIR__, &quot;..&quot;, &quot;..&quot;, &quot;test&quot;, &quot;configs&quot;, &quot;configgenerator.jl&quot;));

julia&gt; cfg = mktemp() do path, io  # write and parse config file on-the-fly
           write(io, generate_sample_config_1())
           flush(io)
           parse_configuration(path)
       end
(data_loader = Garamond.var&quot;#126#136&quot;{Array{Any,1},Dict{Symbol,Any},typeof(Garamond.juliadb_loader)}(Any[&quot;/home/travis/build/zgornel/Garamond.jl/test/data/generated_data_100_samples.csv&quot;], Dict{Symbol,Any}(), Garamond.juliadb_loader), data_sampler = Garamond.identity_sampler, id_key = :id, vectors_eltype = Float32, searcher_configs = Any[(id = &quot;searcher_1&quot;, id_aggregation = &quot;aggid&quot;, description = &quot;A searcher using BM25+RP embeddings and naive indexing&quot;, enabled = Bool[1], search_index = :naive, search_index_arguments = Any[], search_index_kwarguments = Dict{Symbol,Any}(), indexable_fields = Symbol[:RandString, :StringField, :StringField2, :IntField], data_embedder = &quot;embedder_1&quot;, input_embedder = &quot;embedder_1&quot;, heuristic = nothing, score_alpha = 0.4f0, score_weight = 0.8f0)], embedder_configs = Any[(id = &quot;embedder_1&quot;, description = &quot;BM25+RP embedder&quot;, language = &quot;english&quot;, stem_words = false, ngram_complexity = 1, vectors = :bm25, vectors_transform = :rp, vectors_dimension = 50, embeddings_path = nothing, embeddings_kind = :binary, doc2vec_method = :boe, glove_vocabulary = nothing, oov_policy = :large_vector, embedder_kwarguments = Dict{Symbol,Any}(), embeddable_fields = Symbol[:RandString, :StringField, :StringField2, :IntField], text_strip_flags = 0x00700607, sif_alpha = 0.01f0, borep_dimension = 1024, borep_pooling_function = :sum, disc_ngram = 2)], config_path = &quot;/tmp/jl_7wHP6B&quot;)</code></pre><p>The configuration contains the data loader (a closure that only needs to be called with no argument to load the data), the path of the configuration file, the primary id key of the data (which needs to be a <a href="https://juliadb.org">JuliaDB</a> data type) and a list of configuration objects for the individual searchers of the engine.</p><pre><code class="language-julia-repl">julia&gt; for field in fieldnames(typeof(cfg))
           println(&quot;$field=$(getfield(cfg, field))&quot;)
       end
data_loader=#126
data_sampler=identity_sampler
id_key=id
vectors_eltype=Float32
searcher_configs=Any[(id = &quot;searcher_1&quot;, id_aggregation = &quot;aggid&quot;, description = &quot;A searcher using BM25+RP embeddings and naive indexing&quot;, enabled = Bool[1], search_index = :naive, search_index_arguments = Any[], search_index_kwarguments = Dict{Symbol,Any}(), indexable_fields = Symbol[:RandString, :StringField, :StringField2, :IntField], data_embedder = &quot;embedder_1&quot;, input_embedder = &quot;embedder_1&quot;, heuristic = nothing, score_alpha = 0.4f0, score_weight = 0.8f0)]
embedder_configs=Any[(id = &quot;embedder_1&quot;, description = &quot;BM25+RP embedder&quot;, language = &quot;english&quot;, stem_words = false, ngram_complexity = 1, vectors = :bm25, vectors_transform = :rp, vectors_dimension = 50, embeddings_path = nothing, embeddings_kind = :binary, doc2vec_method = :boe, glove_vocabulary = nothing, oov_policy = :large_vector, embedder_kwarguments = Dict{Symbol,Any}(), embeddable_fields = Symbol[:RandString, :StringField, :StringField2, :IntField], text_strip_flags = 0x00700607, sif_alpha = 0.01f0, borep_dimension = 1024, borep_pooling_function = :sum, disc_ngram = 2)]
config_path=/tmp/jl_7wHP6B</code></pre><h2><a class="nav-anchor" id="The-search-environment-1" href="#The-search-environment-1">The search environment</a></h2><p>Building the search environment out of the configuration is straightforward. The environment holds the in-memory data in the form of an <code>IndexedTable</code> or <code>NDSparse</code> object, the searchers as well as other information such as primary db key and configuration paths. </p><pre><code class="language-julia-repl">julia&gt; env = build_search_env(cfg)
[ Info: • Environment successfully built using config /tmp/jl_7wHP6B.
SearchEnv{Float32} with:
`-dbdata = Table with 100 rows, 7 columns
  id_key = id
  sampler = Garamond.identity_sampler
  embedders = [
    RP embedder, 258 to 50, DTV(bm25) vectors
  ]
  searchers = [
    [enabled] Searcher searcher_1/aggid, Naive index, 100 Float32 embedded documents, one embedder
  ]
  config_path = /tmp/jl_7wHP6B</code></pre><h2><a class="nav-anchor" id="Engine-operations-1" href="#Engine-operations-1">Engine operations</a></h2><p>The internal API is designed to be straightforward and uniform in the way it is called. First, one has to build a request which fully describes the operation to be performed and subsequently, call the operation desired. For example, to perform a search, one request would be:</p><pre><code class="language-julia-repl">julia&gt; request = Garamond.InternalRequest(operation=:search,
                                          query=&quot;Q&quot;,
                                          search_method=:exact,
                                          max_matches=10,
                                          response_size=5,
                                          max_suggestions=0,
                                          return_fields=[:id, :RandString, :StringField],
                                          input_parser=:noop_input_parser,
                                          ranker=:noop_ranker)
InternalRequest: OPERATION=:search | QUERY=&quot;Q&quot; | MAX_MATCHES=10 | SEARCH_METHOD=:exact | SEARCHABLE_FILTERS=Symbol[] | MAX_SUGGESTIONS=0 | RETURN_FIELDS=Symbol[:id… | CUSTOM_WEIGHTS=Dict{Symbo… | REQUEST_ID_KEY=Symbol(&quot;&quot;) | SORT_FIELDS=Symbol[] | SORT_REVERSE=false | RESPONSE_SIZE=5 | RESPONSE_PAGE=1 | INPUT_PARSER=:noop_inpu… | RANKER=:noop_rank… | RECOMMENDER=:noop_reco…</code></pre><p>with searching done by</p><pre><code class="language-julia-repl">julia&gt; search_results = search(env, request)
1-element Array{SearchResult{Float32},1}:
 Search results for searcher_1:  10 hits, 1 query terms, 0 suggestions.</code></pre><p>Ranking the results using the ranker specified in the request is done with:</p><pre><code class="language-julia-repl">julia&gt; ranked = rank(env, request, search_results)
1-element Array{SearchResult{Float32},1}:
 Search results for searcher_1:  10 hits, 1 query terms, 0 suggestions.</code></pre><h2><a class="nav-anchor" id="Results-and-responses-1" href="#Results-and-responses-1">Results and responses</a></h2><p>Once results are available, these can be printed</p><pre><code class="language-julia-repl">julia&gt; print_search_results(env.dbdata, ranked; id_key=:id, fields=[:id, :RandString])
[searcher_1] 10 search results:
  0.857034 ~ 12 - Q
  0.8071078 ~ 46 - q
  0.74199486 ~ 68 - Eh
  0.68621206 ~ 48 - 7dHHA0
  0.6794542 ~ 78 - squf7nz
  0.67096984 ~ 60 - ODkB
  0.6637293 ~ 79 - 4
  0.6614511 ~ 80 - vcdBdG4
  0.6565348 ~ 38 - VRcFNAeS
  0.65345657 ~ 36 - r</code></pre><p>or a JSON response created are sent elsewhere</p><pre><code class="language-julia-repl">julia&gt; response = Garamond.build_response(env.dbdata, request, ranked, id_key=env.id_key)
&quot;{\&quot;n_searchers\&quot;:1,\&quot;n_searchers_w_results\&quot;:1,\&quot;suggestions\&quot;:{\&quot;d\&quot;:{}},\&quot;elapsed_time\&quot;:-1.0,\&quot;results\&quot;:{\&quot;searcher_1\&quot;:[{\&quot;id\&quot;:12,\&quot;RandString\&quot;:\&quot;Q\&quot;,\&quot;score\&quot;:0.857034,\&quot;StringField\&quot;:\&quot;\&quot;},{\&quot;id\&quot;:46,\&quot;RandString\&quot;:\&quot;q\&quot;,\&quot;score\&quot;:0.8071078,\&quot;StringField\&quot;:\&quot;A B C D E\&quot;},{\&quot;id\&quot;:68,\&quot;RandString\&quot;:\&quot;Eh\&quot;,\&quot;score\&quot;:0.74199486,\&quot;StringField\&quot;:\&quot;A B\&quot;},{\&quot;id\&quot;:48,\&quot;RandString\&quot;:\&quot;7dHHA0\&quot;,\&quot;score\&quot;:0.68621206,\&quot;StringField\&quot;:\&quot;A B\&quot;},{\&quot;id\&quot;:78,\&quot;RandString\&quot;:\&quot;squf7nz\&quot;,\&quot;score\&quot;:0.6794542,\&quot;StringField\&quot;:\&quot;\&quot;}]},\&quot;n_total_results\&quot;:10}&quot;</code></pre><p>To verify the response, it can be parsed and displayed:</p><pre><code class="language-julia-repl">julia&gt; parsed_response = JSON.parse(response)
Dict{String,Any} with 6 entries:
  &quot;n_searchers&quot;           =&gt; 1
  &quot;n_searchers_w_results&quot; =&gt; 1
  &quot;suggestions&quot;           =&gt; Dict{String,Any}(&quot;d&quot;=&gt;Dict{String,Any}())
  &quot;elapsed_time&quot;          =&gt; -1.0
  &quot;results&quot;               =&gt; Dict{String,Any}(&quot;searcher_1&quot;=&gt;Any[Dict{String,Any…
  &quot;n_total_results&quot;       =&gt; 10

julia&gt; parsed_response[&quot;results&quot;][collect(keys(parsed_response[&quot;results&quot;]))[1]]
5-element Array{Any,1}:
 Dict{String,Any}(&quot;score&quot; =&gt; 0.857034,&quot;StringField&quot; =&gt; &quot;&quot;,&quot;id&quot; =&gt; 12,&quot;RandString&quot; =&gt; &quot;Q&quot;)
 Dict{String,Any}(&quot;score&quot; =&gt; 0.8071078,&quot;StringField&quot; =&gt; &quot;A B C D E&quot;,&quot;id&quot; =&gt; 46,&quot;RandString&quot; =&gt; &quot;q&quot;)
 Dict{String,Any}(&quot;score&quot; =&gt; 0.74199486,&quot;StringField&quot; =&gt; &quot;A B&quot;,&quot;id&quot; =&gt; 68,&quot;RandString&quot; =&gt; &quot;Eh&quot;)
 Dict{String,Any}(&quot;score&quot; =&gt; 0.68621206,&quot;StringField&quot; =&gt; &quot;A B&quot;,&quot;id&quot; =&gt; 48,&quot;RandString&quot; =&gt; &quot;7dHHA0&quot;)
 Dict{String,Any}(&quot;score&quot; =&gt; 0.6794542,&quot;StringField&quot; =&gt; &quot;&quot;,&quot;id&quot; =&gt; 78,&quot;RandString&quot; =&gt; &quot;squf7nz&quot;)</code></pre><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">Introduction</span></a><a class="next" href="../configuration/"><span class="direction">Next</span><span class="title">Configuration</span></a></footer></article></body></html>
